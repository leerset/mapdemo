<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
	<style type="text/css">
		body, html,#allmap {width: 100%;height: 100%;margin:0;font-family:"微软雅黑";}
		#l-map{height:80%;width:100%;}
	</style>
	<script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=6YEOGgEs5NGQHvg36wFHyMsj5E07xnTU&s=1"></script>
	<title>DEMO</title>
</head>
<body>
	<div style="width:94%;height:94%;margin:2%;padding:1%;border-color:black;border-width:1px;border-style:solid;">
		<div id="title" style="height:10%;">
			<img class="img" style="height:100%;float:left;" src="images/pipe_green.png"></img>
			<div id="text" class="text" style="height:60px;font-size:30px;float:left;margin:15px;">
				<span>流域水环境精细化管理决策支持系统</sapn>
			</div>
		</div>
		<div>
			<hr style="width:100%;height:1px;border:none;border-top:1px double black;" />
		</div>
		<div id="l-map"></div>
		<div id="r-result">
			<input type="button" onclick="showOver()" value="显示" />
			<input type="button" onclick="hideOver()" value="隐藏" />
			<input type="button" onclick="addDrops()" value="添加点" />
			<input type="button" onclick="addPipes()" value="添加管道" />
			<input type="button" onclick="addBoxes()" value="添加河面" />
			<input type="button" onclick="addLines()" value="添加线" />
			<input type="button" onclick="addCircles()" value="添加面" />
			<input type="button" onclick="addFlow()" value="添加流水" />
			<input type="button" onclick="addOver()" value="添加覆盖物" />


		</div>
	</div>
</body>
</html>
<script type="text/javascript">
	// 百度地图API功能
	var map = new BMap.Map("l-map");
	// map.setMapStyle({style: 'light'});
	var point = new BMap.Point(114.0515977283,22.5199590014);
	map.centerAndZoom(point, 16);

	var drop_icons = [];
	drop_icons.push(new BMap.Icon("images/drop_green.png", new BMap.Size(40,40)
		,{
			offset: new BMap.Size(0, 0), // 指定定位位置
			imageOffset: new BMap.Size(20, 0) // 设置图片偏移
		}
	));
	drop_icons.push(new BMap.Icon("images/drop_red.png", new BMap.Size(40,40)	,{
			offset: new BMap.Size(0, 0), // 指定定位位置
			imageOffset: new BMap.Size(20, 0) // 设置图片偏移
		}
	));
	drop_icons.push(new BMap.Icon("images/drop_orange.png", new BMap.Size(40,40)	,{
			offset: new BMap.Size(0, 0), // 指定定位位置
			imageOffset: new BMap.Size(20, 0) // 设置图片偏移
		}
	));
	drop_icons.push(new BMap.Icon("images/drop_grey.png", new BMap.Size(40,40)	,{
			offset: new BMap.Size(0, 0), // 指定定位位置
			imageOffset: new BMap.Size(20, 0) // 设置图片偏移
		}
	));

	var pipe_icons = [];
	pipe_icons.push(new BMap.Icon("images/pipe_green.png", new BMap.Size(20,20)));
	pipe_icons.push(new BMap.Icon("images/pipe_red.png", new BMap.Size(20,20)));
	pipe_icons.push(new BMap.Icon("images/pipe_orange.png", new BMap.Size(20,20)));
	pipe_icons.push(new BMap.Icon("images/pipe_grey.png", new BMap.Size(20,20)));

	var box_icons = [];
	box_icons.push(new BMap.Icon("images/box_green.png", new BMap.Size(20,20)));
	box_icons.push(new BMap.Icon("images/box_red.png", new BMap.Size(20,20)));
	box_icons.push(new BMap.Icon("images/box_orange.png", new BMap.Size(20,20)));
	box_icons.push(new BMap.Icon("images/box_grey.png", new BMap.Size(20,20)));

	var circles = [];
	var p1 = new BMap.Point(114.0469272065,22.5191553878);
	var p2 = new BMap.Point(114.0478677201,22.5232816411);
	var p3 = new BMap.Point(114.0498632836,22.5280784373);
	var p4 = new BMap.Point(114.0531855960,22.5154790956);
	var p5 = new BMap.Point(114.0566152307,22.5219838553);
	var p6 = new BMap.Point(114.0584820482,22.5259085518);
	var p7 = new BMap.Point(114.0564006540,22.5286240594);

	var points = [p1,p2,p3,p4,p5,p6,p7];
	var rads = [95,205,275,165,205,235,95];
	for(i=0;i<7;i++){
		var c = new BMap.Circle(points[i], rads[i], {strokeColor:"blue", strokeWeight:0, strokeOpacity:0,fillOpacity: 0.8, fillColor: "#FFFFFF"});
		circles.push(c);
	}
		// tileLayer.getTilesUrl = function(tileCoord, zoom) {
		// 	var x = tileCoord.x;
		// 	var y = tileCoord.y;
		// 	var url = '/Users/leerset/projects/mapdemo/images/drop_grey.png';     //根据当前坐标，选取合适的瓦片图
		// 	return url;
		// }

	var pipe_points = [
		new BMap.Point(114.0488154816,22.5155873085),
		new BMap.Point(114.0512831139,22.5196311248),
		new BMap.Point(114.0536540720,22.5234506741),
		new BMap.Point(114.0488154816,22.5155873085),
		new BMap.Point(114.0523022386,22.5213693725),
		new BMap.Point(114.0536540720,22.5234506741),
		new BMap.Point(114.0559715006,22.5276131832)
	];

	var box_points = [
		new BMap.Point(114.0456492019, 22.5101174748),
		new BMap.Point(114.0504033494, 22.5176488767),
		new BMap.Point(114.0512616563, 22.5190760982),
		new BMap.Point(114.0518123050, 22.5204743795),
		new BMap.Point(114.0550702783, 22.5255914087),
		new BMap.Point(114.0559715006,22.5276131832)];

	var polyline = new BMap.Polyline(box_points, {strokeColor:"blue", strokeWeight:15, strokeOpacity:0});

	var pl1 = new BMap.Polyline([
		p1,
		new BMap.Point(114.0488154816,22.5155873085)
	], {strokeColor:"blue", strokeWeight:5, strokeOpacity:0});

	var pl2 = new BMap.Polyline([
		p2,
		new BMap.Point(114.0512831139,22.5196311248)
	], {strokeColor:"blue", strokeWeight:5, strokeOpacity:0});

	var pl3 = new BMap.Polyline([
		p3,
		new BMap.Point(114.0536540720,22.5234506741)
	], {strokeColor:"blue", strokeWeight:5, strokeOpacity:0});

	var pl4 = new BMap.Polyline([
		p4,
		new BMap.Point(114.0488154816,22.5155873085)
	], {strokeColor:"blue", strokeWeight:5, strokeOpacity:0});

	var pl5 = new BMap.Polyline([
		p5,
		new BMap.Point(114.0523022386,22.5213693725)
	], {strokeColor:"blue", strokeWeight:5, strokeOpacity:0});

	var pl6 = new BMap.Polyline([
		p6,
		new BMap.Point(114.0536540720,22.5234506741)
	], {strokeColor:"blue", strokeWeight:5, strokeOpacity:0});

	var pl7 = new BMap.Polyline([
		p7,
		new BMap.Point(114.0559715006,22.5276131832)
	], {strokeColor:"blue", strokeWeight:5, strokeOpacity:0});

	hideOver();

	function showOver(){
		marker1.show(); polyline.show(); circle1.show();circle2.show();circle3.show();
	}
	function hideOver(){
		map.clearOverlays();
	}
	function addDrops(){
		// 随机向地图添加标注
		for (var i = 0; i < 3; i ++) {
			for (var j = 0; j < 7; j ++) {
				var point = points[j];
				var rad = rads[j] / 56572.0;
				var pointR = new BMap.Point(point.lng + rad * (Math.random() * 0.8) - rad * (Math.random() * 0.8), point.lat + rad * (Math.random() * 0.8) - rad * (Math.random() * 0.8));
				var idx = parseInt(Math.random() * 4);
				var markerR = new BMap.Marker(pointR,{icon:drop_icons[idx]});
				map.addOverlay(markerR);
			}
		}
		points.forEach(function (point) {
			var markerR = new BMap.Marker(point);
			map.addOverlay(markerR);
		})
	}
	function addPipes(){
		// 随机向地图添加标注
		pipe_points.forEach(function (point) {
			var idx = parseInt(Math.random() * 4);
			var markerR = new BMap.Marker(point,{icon:pipe_icons[idx]});
			map.addOverlay(markerR);
		})
	}
	function addBoxes(){
		// 随机向地图添加标注
		box_points.forEach(function (point) {
			var idx = parseInt(Math.random() * 4);
			var markerR = new BMap.Marker(point,{icon:box_icons[idx]});
			map.addOverlay(markerR);
		})
	}
	// function addLines(){
	// 	// 随机向地图添加25个标注
	// 	var bounds = map.getBounds();
	// 	var sw = bounds.getSouthWest();
	// 	var ne = bounds.getNorthEast();
	// 	var lngSpan = Math.abs(sw.lng - ne.lng);
	// 	var latSpan = Math.abs(ne.lat - sw.lat);
	// 	var points = [];
	// 	for (var i = 0; i < 5; i ++) {
	// 		var pointR = new BMap.Point(sw.lng + lngSpan * 0.3 + lngSpan * (Math.random() * 0.4), ne.lat - latSpan * 0.3 - latSpan * (Math.random() * 0.4));
	// 		points.push(pointR);
	// 	}
	// 	var polyline = new BMap.Polyline(points, {strokeColor:"green", strokeWeight:10, strokeOpacity:0});
	// 	map.addOverlay(polyline);
	// }
	function addLines(){
		map.addOverlay(polyline);
		map.addOverlay(pl1);
		map.addOverlay(pl2);
		map.addOverlay(pl3);
		map.addOverlay(pl4);
		map.addOverlay(pl5);
		map.addOverlay(pl6);
		map.addOverlay(pl7);
	}

	function addCircles(){
		circles.forEach(function (c) {
			map.addOverlay(c);
		});
	}

	function addFlow() {
		addPolylines();
		adynamicLines();
	}

	function getCirclePoints(lng, lat, raidus) {
		var circlePoints = [];
		var degree = (24901 * 1609) / 360.0;
    var dpmLat = 1 / degree;
		var mpdLng = degree * Math.cos(lat * (Math.PI / 180));
    var dpmLng = 1 / mpdLng;

    var radiusLat = dpmLat * raidus;
    var minLat = lat - radiusLat;
    var maxLat = lat + radiusLat;

    var radiusLng = dpmLng * raidus;
    var minLng = lng - radiusLng;
    var maxLng = lng + radiusLng;
		for (var a = 120; a <= 120 + 360; a += 1) {
			var cos = Math.cos(a / 180 * Math.PI);
			var sin = Math.sin(a / 180 * Math.PI);
			// if (a == 0) { sin = 0; cos = 1;}
			// if (a == 90) { sin = 1; cos = 0;}
			// if (a == 180) { sin = 0; cos = -1;}
			// if (a == 270) { sin = -1; cos = 0;}
			// if (a == 360) { sin = 0; cos = 1;}
			// if (a == 30) { sin = 0.5;}
			// if (a == 210) { sin = -0.5;}
			// if (a == 60) { cos = 0.5;}
			// if (a == 240) { cos = -0.5;}
			var ln = parseFloat((lng + radiusLng * cos).toFixed(6))
			var la = parseFloat((lat + radiusLat * sin).toFixed(6))
			if ( circlePoints.length > 0 &&
				   la == circlePoints[circlePoints.length - 1].lat) {
				la += 0.000001;
			}
			if ( circlePoints.length > 0 &&
				   ln == circlePoints[circlePoints.length - 1].lng) {
				ln += 0.000001;
			}
			circlePoints.push(new BMap.Point(ln, la))
		}
		// for (var a = 121; a <= 240; a += 60) {
		// 	circlePoints.push(new BMap.Point(lng + radiusLng * Math.cos(a / 180 * Math.PI), lat + radiusLat * Math.sin(a / 180 * Math.PI)))
		// }
		return circlePoints;
	}

	function addOver() {
		var points = getCirclePoints(114.049667, 22.516488, 500);
		var ps = []
		ps.push(new BMap.Point(114.005048,22.500917))
		ps.push(new BMap.Point(114.087046,22.500917))
		ps.push(new BMap.Point(114.087046,22.537174))
		ps.push(new BMap.Point(114.005048,22.537174))
		ps.push(new BMap.Point(114.005048,22.500917))
		ps = ps.concat(points)
		ps.push(new BMap.Point(114.005048,22.500917))

		// var ps = [];
		// var lnglats = [];
		// lnglats.push({lng: 114.050326135767, lat: 22.510211})
		// lnglats.push({lng: 114.0478945678835, lat: 22.514101})
		// lnglats.push({lng: 114.04303143211649, lat: 22.514102})
		// lnglats.push({lng: 114.040599864233, lat: 22.510211})
		// lnglats.push({lng: 114.04303143211649, lat: 22.506320})
		// lnglats.push({lng: 114.0478945678835, lat: 22.506321})
		// lnglats.push({lng: 114.050326135767, lat: 22.510211})
		// for (var i = 0; i < lnglats.length; i++ ) {
		// 	ps.push(new BMap.Point(lnglats[i].lng, lnglats[i].lat))
		// }

		// var curve = new BMapLib.CurveLine(ps.reverse(), {strokeColor:"blue", strokeWeight:1, strokeOpacity:0.5}); //创建弧线对象
		var curve = new BMap.Polygon(ps, {strokeColor:"none", strokeWeight:1, strokeOpacity:0.4, fillColor: "rgb(116,216,216)", fillOpacity:0.5}); //创建弧线对象
		map.addOverlay(curve);
	}

	var polylines = [];
	var linePoints = [
		new BMap.Point(114.045463,22.510211),
		new BMap.Point(114.045714,22.510645),
		new BMap.Point(114.046109,22.511113),
		new BMap.Point(114.046433,22.511547),
		new BMap.Point(114.04672,22.512048),
		new BMap.Point(114.046972,22.512415),
		new BMap.Point(114.047187,22.512682),
		new BMap.Point(114.047367,22.513016),
		new BMap.Point(114.047942,22.513884),
		new BMap.Point(114.048194,22.514318),
		new BMap.Point(114.048481,22.514719),
		new BMap.Point(114.048697,22.515019),
		new BMap.Point(114.048876,22.515253),
		new BMap.Point(114.048984,22.51552),
		new BMap.Point(114.049236,22.515887),
		new BMap.Point(114.049487,22.516188),
		new BMap.Point(114.049667,22.516488),
		new BMap.Point(114.04981,22.516722),
		new BMap.Point(114.049918,22.517022),
		new BMap.Point(114.050206,22.517323),
		new BMap.Point(114.050349,22.517623),
		new BMap.Point(114.050457,22.517824),
		new BMap.Point(114.050745,22.518157),
		new BMap.Point(114.050817,22.518458),
		new BMap.Point(114.051104,22.518758),
		new BMap.Point(114.051212,22.519092),
		new BMap.Point(114.051427,22.51986),
		new BMap.Point(114.051535,22.520261),
		new BMap.Point(114.051715,22.520561),
		new BMap.Point(114.051895,22.520862),
		new BMap.Point(114.052038,22.521095),
		new BMap.Point(114.052146,22.521296),
		new BMap.Point(114.052398,22.521529),
		new BMap.Point(114.052541,22.521796),
		new BMap.Point(114.052649,22.522063),
		new BMap.Point(114.052793,22.522264),
		new BMap.Point(114.052972,22.522564),
		new BMap.Point(114.053368,22.523165),
		new BMap.Point(114.053691,22.523666),
		new BMap.Point(114.053799,22.523866),
		new BMap.Point(114.053979,22.524133),
		new BMap.Point(114.05405,22.524267),
		new BMap.Point(114.054086,22.524534),
		new BMap.Point(114.054266,22.524768),
		new BMap.Point(114.054482,22.524968),
		new BMap.Point(114.054733,22.525335),
		new BMap.Point(114.054805,22.525502),
		new BMap.Point(114.054949,22.525769),
		new BMap.Point(114.054985,22.525869),
		new BMap.Point(114.054985,22.525869),
		new BMap.Point(114.054985,22.525869)
	];

	var plOpts = [];
	for (var a=0; a < 51; a ++) {
		plOpts.push({strokeColor:"#00f",strokeWeight:2 + (60 - a) / 5,strokeOpacity:"0.4"});
	}

	function addPolylines(){
    for(var i = 0; i < linePoints.length - 2; i++){
      var polyline = new BMap.Polyline([linePoints[i],linePoints[i+1]],plOpts[i]);
			map.addOverlay(polyline);   //增加折线
			// polyline.hide();
      polylines.push(polyline);
    }
  }

	//数据准备,
	var apoints = [
		new BMap.Point(114.045463,22.510211),
		new BMap.Point(114.045714,22.510645),
		new BMap.Point(114.046109,22.511113),
		new BMap.Point(114.046433,22.511547),
		new BMap.Point(114.04672,22.512048),
		new BMap.Point(114.046972,22.512415),
		new BMap.Point(114.047187,22.512682),
		new BMap.Point(114.047367,22.513016),
		new BMap.Point(114.047942,22.513884),
		new BMap.Point(114.048194,22.514318),
		new BMap.Point(114.048481,22.514719),
		new BMap.Point(114.048697,22.515019),
		new BMap.Point(114.048876,22.515253),
		new BMap.Point(114.048984,22.51552),
		new BMap.Point(114.049236,22.515887),
		new BMap.Point(114.049487,22.516188),
		new BMap.Point(114.049667,22.516488),
		new BMap.Point(114.04981,22.516722),
		new BMap.Point(114.049918,22.517022),
		new BMap.Point(114.050206,22.517323),
		new BMap.Point(114.050349,22.517623),
		new BMap.Point(114.050457,22.517824),
		new BMap.Point(114.050745,22.518157),
		new BMap.Point(114.050817,22.518458),
		new BMap.Point(114.051104,22.518758),
		new BMap.Point(114.051212,22.519092),
		new BMap.Point(114.051427,22.51986),
		new BMap.Point(114.051535,22.520261),
		new BMap.Point(114.051715,22.520561),
		new BMap.Point(114.051895,22.520862),
		new BMap.Point(114.052038,22.521095),
		new BMap.Point(114.052146,22.521296),
		new BMap.Point(114.052398,22.521529),
		new BMap.Point(114.052541,22.521796),
		new BMap.Point(114.052649,22.522063),
		new BMap.Point(114.052793,22.522264),
		new BMap.Point(114.052972,22.522564),
		new BMap.Point(114.053368,22.523165),
		new BMap.Point(114.053691,22.523666),
		new BMap.Point(114.053799,22.523866),
		new BMap.Point(114.053979,22.524133),
		new BMap.Point(114.05405,22.524267),
		new BMap.Point(114.054086,22.524534),
		new BMap.Point(114.054266,22.524768),
		new BMap.Point(114.054482,22.524968),
		new BMap.Point(114.054733,22.525335),
		new BMap.Point(114.054805,22.525502),
		new BMap.Point(114.054949,22.525769),
		new BMap.Point(114.054985,22.525869),
		new BMap.Point(114.054985,22.525869),
		new BMap.Point(114.054985,22.525869)
	];//原始点信息数组
	var points = [];//百度化坐标数组。用于更新显示范围。
	var bPoints = [];//百度化坐标数组。用于更新显示范围。
	//创建标注点并添加到地图中
	function addMarker(points) {
	    //循环建立标注点
	    for(var i=0, pointsLen = points.length; i<pointsLen; i++) {
	        var point = new BMap.Point(points[i].lng, points[i].lat); //将标注点转化成地图上的点
	        var marker = new BMap.Marker(point); //将点转化成标注点
	        map.addOverlay(marker);  //将标注点添加到地图上
	        //添加监听事件
	        (function() {
	            var thePoint = points[i];
	            marker.addEventListener("click",
	                function() {
	                showInfo(this,thePoint);
	            });
	         })();
	    }
	}

	//添加线
	function addLine(points){

	    var linePoints = [],pointsLen = points.length,i,polyline;
	    if(pointsLen == 0){
	        return;
	    }
	    // 创建标注对象并添加到地图
	    for(i = 0;i <pointsLen;i++){
	        linePoints.push(new BMap.Point(points[i].lng,points[i].lat));
	    }

	    polyline = new BMap.Polyline(linePoints, {strokeColor:"blue", strokeWeight:5, strokeOpacity:1});   //创建折线
	    map.addOverlay(polyline);   //增加折线
	}

	var offset = 2;

	//随机生成新的点，加入到轨迹中。
	function adynamicLines(){
		for (var i = 0; i < polylines.length; i++) {
			polylines[i].hide();
		}
		for (var i = 0; i < polylines.length / 3 - 1; i++) {
			polylines[i * 3 + offset].show();
		}
		offset -= 1;
		if (offset == -1) {offset = 2;}
    setTimeout(adynamicLines, 500);
	}

</script>
